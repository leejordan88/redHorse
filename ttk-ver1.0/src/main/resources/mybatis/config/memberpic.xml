<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="memberpic">

<!-- 12/2 효민 사진 업로드 -->
 <insert id="uploadMemberPic" parameterType="memberPicVO">
 	<selectKey keyProperty="pictureNo" resultType="int" order="BEFORE">
 		select memberPicture_seq.nextval from dual
 	</selectKey>
 	insert into memberPicture(pictureNo,id,filename,pictureTitle,pictureContent,pictureDate) 
 	values(#{pictureNo}, #{memberVO.id}, #{fileName},#{pictureTitle},#{pictureContent},sysdate)
 </insert>
 
 <!-- 비매칭 부분 매칭 -->
 <resultMap type="MemberPicVO" id="memberPicRM">
	<result column="id" property="memberVO.id"/>
</resultMap>

 <!-- 사진첩 리스트 -->
 <select id="getPictureList" resultMap="memberPicRM">
 	select pictureNo, id, filename, pictureTitle, pictureContent, to_char(pictureDate, 'YYYY.MM.DD')as pictureDate, hit
 	from memberPicture order by pictureNo desc
 </select>
 
 <!-- 12/4 효민 사진 상세보기 -->
 <!-- 조회수 -->
 <update id="updateHit" parameterType="int">
	update memberPicture set hit=hit+1 where pictureNo=#{pictureNo}
</update>

<!-- 상세보기 -->
<select id="showPictureDetail" resultMap="memberPicRM">
	 select pictureNo, id, filename, pictureTitle, pictureContent, to_char(pictureDate, 'YYYY.MM.DD')as pictureDate, hit
 		from memberPicture where pictureNo=#{pictureNo}
</select>

<select id="visitMemberPic" resultMap="memberPicRM" resultType="memberPicVO">
 	select pictureNo, id, filename, pictureTitle, to_char(pictureDate, 'YYYY.MM.DD')as pictureDate
 	from memberPicture where id=#{value} order by pictureNo desc
</select>



</mapper>