<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="memberpic">

<!-- 12/2 효민 사진 업로드 -->
 <insert id="uploadMemberPic" parameterType="memberPicVO">
 	<selectKey keyProperty="pictureNo" resultType="int" order="BEFORE">
 		select memberPicture_seq.nextval from dual
 	</selectKey>
 	insert into memberPicture(pictureNo,id,filename,pictureTitle,pictureContent,pictureDate) 
 	values(#{pictureNo}, #{memberVO.id}, #{fileName},#{pictureTitle},#{pictureContent},sysdate)
 </insert>
 
 <!-- 비매칭 부분 매칭 -->
 <resultMap type="MemberPicVO" id="memberPicRM">
	<result column="id" property="memberVO.id"/>
	<result column="name" property="memberVO.name"/>
</resultMap>

 <!-- 사진첩 리스트, 12/5수정 where id =#{value}부분 추가-->
 <select id="getPictureList" resultMap="memberPicRM">
 	select pictureNo, id, filename, pictureTitle, pictureContent, to_char(pictureDate, 'YYYY.MM.DD')as pictureDate, hit
 	from memberPicture where id=#{value} order by pictureNo desc
 </select>
 
 <!-- 12/4 효민 사진 상세보기 -->
 <!-- 조회수 -->
 <update id="updateHit" parameterType="int">
	update memberPicture set hit=hit+1 where pictureNo=#{pictureNo}
</update>

<!-- 상세보기 -->
<select id="showPictureDetail" resultMap="memberPicRM">
	 select p.pictureNo, p.id, m.name, p.filename, p.pictureTitle, p.pictureContent, to_char(p.pictureDate, 'YYYY.MM.DD')as pictureDate, p.hit
 		from memberPicture p, member m where p.pictureNo=#{p.pictureNo} and p.id=m.id
</select>

<!-- 사진 수정하기 -->
<update id="updateMemberPic" parameterType="memberPicVO">
	update memberPicture set     where pictureNo=#{pictureNo}
</update>

<!-- 사진 삭제하기 -->
<delete id="deleteMemberPic">
		delete from memberPicture where pictureNo=#{value}
</delete>
</mapper>
